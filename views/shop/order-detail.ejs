<h2>Đơn hàng #<%= order.id %></h2>
<p>Trạng thái: <strong><%= order.status %></strong> — <small><%= order.created_at %></small></p>

<div style="display:flex;gap:24px;flex-wrap:wrap">
  <div style="flex:1;min-width:300px">
    <h4>Địa chỉ giao hàng</h4>
    <% if (orderAddress) { %>
      <p>
        <strong><%= orderAddress.recipient %></strong><br/>
        <%= orderAddress.phone %><br/>
        <%= orderAddress.street %><br/>
        <%= orderAddress.city %> <% if(orderAddress.postcode){ %> — <%= orderAddress.postcode %> <% } %>
      </p>
    <% } else if (defaultAddress) { %>
      <p>
        <strong><%= defaultAddress.recipient %></strong><br/>
        <%= defaultAddress.phone %><br/>
        <%= defaultAddress.street %><br/>
        <%= defaultAddress.city %> <% if(defaultAddress.postcode){ %> — <%= defaultAddress.postcode %> <% } %>
      </p>
      <p><em>Đang dùng địa chỉ mặc định của bạn.</em></p>
    <% } else { %>
      <p><em>Chưa có địa chỉ giao hàng được chỉ định.</em> Vui lòng chỉnh sửa đơn hàng để thêm địa chỉ.</p>
    <% } %>

    <div style="margin-top:12px">
      <% if (order.status !== 'shipped' && order.status !== 'cancelled') { %>
        <a class="btn" href="/order/<%= order.id %>/edit">Chỉnh sửa</a>
        <form method="post" action="/order/<%= order.id %>/cancel" style="display:inline;margin-left:8px">
          <button class="btn-ghost" type="submit" onclick="return confirm('Bạn có chắc muốn hủy đơn hàng này?')">Hủy đơn</button>
        </form>
      <% } %>
      <a href="/order-status" class="btn-ghost" style="margin-left:8px">Quay lại</a>
    </div>
  </div>

  <div style="flex:1;min-width:320px">
    <h4>Sản phẩm</h4>
    <table style="width:100%;border-collapse:collapse">
      <thead>
        <tr>
          <th style="text-align:left;padding:8px">Sản phẩm</th>
          <th style="padding:8px">Số lượng</th>
          <th style="padding:8px">Giá</th>
        </tr>
      </thead>
      <tbody>
        <% let sum = 0; items.forEach(function(i){ %>
          <tr>
            <td style="padding:8px"><%= i.title %> <% if(i.option){ %> — <small>Size: <%= i.option %></small><% } %></td>
            <td style="padding:8px;text-align:center"><%= i.quantity %></td>
            <td style="padding:8px;text-align:right"><%= (i.price || 0).toLocaleString() %> VND</td>
          </tr>
        <% sum += (i.price || 0) * (i.quantity || 0); }); %>
        <tr>
          <td colspan="2" style="padding:8px;text-align:right"><strong>Tổng</strong></td>
          <td style="padding:8px;text-align:right"><strong><%= (order.total || sum).toLocaleString() %> VND</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
